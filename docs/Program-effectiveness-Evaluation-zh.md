æ­£å¦‚Readmeæ–‡æ¡£ä¸­æ‰€æè¿°ï¼Œè°ƒåº¦å™¨å°†æ ¹æ®ä¸åŒæ¨ç†å¼•æ“æœåŠ¡èŠ‚ç‚¹çš„scoreå€¼è¿›è¡Œweight randomé€‰æ‹©ã€‚æœ¬æ–‡æ¡£é€šè¿‡ç«¯åˆ°ç«¯çš„æµ‹è¯•æ–¹æ³•æ¥éªŒè¯è°ƒåº¦å™¨å·¥ä½œçš„æœ‰æ•ˆæ€§ã€‚

## 1. ç«¯åˆ°ç«¯æµ‹è¯•è¯„ä¼°æ–¹æ³•

### F5 Mock API

`./tests/f5-mock-api/f5-mock-api-updated.py`ç”¨äºæ¨¡æ‹ŸF5 iControl Restã€‚å¯åŠ¨è¯¥ç¨‹åº:

```
python3 f5-mock-api-update.py
```

è¯¥mock API å¯ä»¥æ¨¡æ‹Ÿç™»å½•éªŒè¯ã€tokensè·å–ï¼Œä»¥åŠè·å–ä¸¤ä¸ªpoolï¼ˆ`example_pool1`,`example_pool2`)çš„membersä¿¡æ¯ã€‚ç¨‹åºä¸­çš„`DYNAMIC_MODE = 0`è¡¨ç¤ºä¸æ¨¡æ‹Ÿpool membersçš„å¢å‡ï¼Œå§‹ç»ˆä¿æŒç¨‹åºä¸­è®¾å®šçš„3ä¸ªæˆå‘˜ã€‚å¦‚æœè®¾ç½®`DYNAMIC_MODE = 1`åˆ™è¡¨ç¤ºç¨‹åºéšæœºæ¨¡æ‹ŸPool membersçš„å¢å‡ï¼ˆ0-3ä¸ªæˆå‘˜ï¼‰ã€‚



### LLM Mock API

`./tests/llm-mock-api/main.py`æ˜¯æ¨¡æ‹ŸvLLMçš„metricsæ¥å£çš„ä¸»ç¨‹åºï¼Œ`./tests/llm-mock-api/main_sglang.py`æ¨¡æ‹ŸSGlangçš„metricsæ¥å£çš„ä¸»ç¨‹åºã€‚ä¸»ç¨‹åºä¼šå¯åŠ¨å„è‡ªçš„3ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æ¨¡æ‹Ÿä¸€ä¸ªLLM Inference serverã€‚å¯åŠ¨ç¨‹åºï¼š

```
python3 main.py
python3 main_sglang.py
```

è¿›ç¨‹ç¨‹åº(å¦‚app_vllm.py)ï¼Œé»˜è®¤10åˆ†é’Ÿä¸»åŠ¨å˜åŒ–ä¸€æ¬¡metricså€¼ã€‚ä¹Ÿå¯ä»¥é€šè¿‡`/trigger_update` APIæ¥å£ä¸»åŠ¨è§¦å‘metricsæ›´æ–°ã€‚ä¿®æ”¹ç¨‹åºä¸­çš„`DYNAMIC_UPDATE_ENABLED = True` ä¸º`False`å¯ä»¥å…³é—­metricsåŠ¨æ€æ›´æ–°ã€‚åŠ¨æ€æ›´æ–°å¼€å…³ä¹Ÿå¯ä»¥é€šè¿‡API endpoint`POST /toggle_update/1 or /toggle_update/0`æ¥ä»å¤–éƒ¨æ§åˆ¶ã€‚

> åœ¨ç»§ç»­åç»­çš„æ­¥éª¤å‰ï¼Œä½ éœ€è¦å¯åŠ¨ä¸Šè¿°ä¸¤ä¸ªAPI



### å®¢æˆ·ç«¯æµ‹è¯•ç¨‹åº

`./tests/Client_requests_test_and_caculator_full_report.py` ç”¨äºæ¨¡æ‹Ÿå‘èµ·åˆ°è°ƒåº¦å™¨çš„è¯·æ±‚ã€‚ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°†è¯¢é—®ç”¨æˆ·æ¨¡æ‹Ÿå¤šå°‘è½®æµ‹è¯•ï¼Œå‡è®¾ç”¨æˆ·è¾“å…¥30ï¼Œåˆ™è¡¨ç¤ºè¿›è¡Œ30è½®æµ‹è¯•ï¼Œæ¯è½®æµ‹è¯•é€»è¾‘å¦‚ä¸‹ï¼š

- å‘è°ƒåº¦å™¨å‘é€1000æ¬¡APIè¯·æ±‚ã€‚æ¯æ¬¡è¯·æ±‚è°ƒåº¦å™¨éƒ½ä¼šè¿”å›ä¸€ä¸ªmemberä¿¡æ¯ï¼ˆæ ¹æ®weight randomç®—æ³•ï¼‰ã€‚åœ¨è¿™1000æ¬¡è¿‡ç¨‹ä¸­ï¼ŒLLMçš„metricsæ˜¯ä¿æŒä¸å˜çš„ã€‚
- ç¨‹åºåœ¨å®Œæˆ1000æ¬¡è¯·æ±‚åï¼Œç»Ÿè®¡å„ä¸ªmemberå‡ºç°çš„å®é™…ç™¾åˆ†æ¯”æ¦‚ç‡ã€‚
- ç¨‹åºä¼šé€šè¿‡è°ƒåº¦å™¨çš„`/pools/status` APIç«¯ç‚¹è·å–æœ¬è½®æ¬¡ä¸­å„ä¸ªLLM Inference serverçš„scoreå€¼ï¼Œæ¥è®¡ç®—å„ä¸ªserverçš„ç†è®ºç™¾åˆ†æ¯”æ¦‚ç‡ã€‚
- ç¨‹åºå‘LLM mock APIçš„`/trigger_update` ç«¯ç‚¹å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œæ¥è§¦å‘ä¸€æ¬¡metricså€¼çš„æ›´æ–°ï¼Œä»¥æ–¹ä¾¿ä¸‹è½®æµ‹è¯•ã€‚

ç¨‹åºè¿è¡Œå®Œæˆåï¼Œå°†è‡ªåŠ¨äº§ç”Ÿå¯è§†åŒ–å›¾è¡¨æ–‡ä»¶ã€‚

> æ³¨æ„ï¼Œå¦‚æœæ˜¯è¿œç¨‹ç»ˆç«¯è¿è¡Œï¼Œè¯·æ³¨é‡Šæ‰æ­¤è¯­å¥plt.show()  # If running locally, you can also uncomment to view in real time



æ¯ä¸€è½®æ¬¡æµ‹è¯•ç»ˆç«¯è¾“å‡ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š

```
=== Round 1 test begins ===
Test results statistics:
---------------------
Total requests: 1000
Successful requests: 1000
Failed requests: 0
#First column is member, second column is selection probability, third column is percent field from /pools/status interface
----Member selection probability and score distribution probability----
127.0.0.1:8001,33.60%,32.04%
127.0.0.1:8002,62.40%,63.11%
127.0.0.1:8003,4.00%,4.85%
--------------------------------------------
Pausing 1 second, preparing to trigger metrics update...
All metrics update requests executed successfully.

```



### ç¨‹åºæœ‰æ•ˆæ€§è¯„ä¼°ç»“æœï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰

é€šè¿‡æ¨¡æ‹Ÿ30è½®ï¼ˆæ¯è½®1000æ¬¡è¯·æ±‚ï¼‰ï¼Œå„ä¸ªPool memberè¢«é€‰æ‹©çš„å®é™…æ¦‚ç‡ä¸ç†è®ºæ¦‚ç‡å¦‚ä¸‹ã€‚

å›¾ä¾‹ï¼š

- è“è‰²ä»£è¡¨å®é™…é€‰æ‹©æ¦‚ç‡
- æ©™è‰²ä»£è¡¨ç†è®ºæ¦‚ç‡

å¯ä»¥å‘ç°ï¼Œç¨‹åºå®é™…é€‰æ‹©ç»“æœä¸ç†è®ºåå·®è¾ƒå°ï¼Œç¬¦åˆé¢„æœŸã€‚

![127.0.0.1_8001_trend](Program-effectiveness-Evaluation.assets/127.0.0.1_8001_trend.png)

![127.0.0.1_8002_trend](Program-effectiveness-Evaluation.assets/127.0.0.1_8002_trend.png)

![127.0.0.1_8003_trend](Program-effectiveness-Evaluation.assets/127.0.0.1_8003_trend.png)

## 2. é€šè¿‡è°ƒåº¦å™¨è‡ªèº«APIæ¥å£è¯„ä»·æ–¹æ³•

è°ƒåº¦å™¨æœ¬èº«æä¾›äº†ä¸€ä¸ª`analyze` APIç«¯ç‚¹ï¼Œè¯¥æ¥å£å¯ä»¥è‡ªåŠ¨åœ¨ç¨‹åºå†…éƒ¨æ¨¡æ‹Ÿï¼Œå¹¶ç»™å‡ºå„ä¸ªæ¨ç†èŠ‚ç‚¹é€‰æ‹©çš„å®é™…æ¦‚ç‡ã€ç†è®ºæ¦‚ç‡ã€åå·®åˆ†æï¼ˆå¹³å‡åå·®ã€æœ€å¤§åå·®ã€æœ€å°åå·®ã€æ ‡å‡†å·®ï¼‰ï¼Œå¹¶æ ¹æ®é™„ä»¶ä¸­çš„è¯„ä¼°æ ‡å‡†ï¼Œç»™å‡ºè´¨é‡æœ€ç»ˆè´¨é‡è¯„ä¼°ã€‚APIæ¥å£è®¿é—®ï¼š

```
curl -X POST http://localhost:8080/pools/example_pool1/Common/analyze \                                                                            on git:main|â€¦6
   -H "Content-Type: application/json" \
   -d '{
     "pool_name": "example_pool1",
     "partition": "Common",
     "request": "ScheduleRequest",
     "members": ["127.0.0.1:8001", "127.0.0.1:8002", "127.0.0.1:8003"],
     "iterations": 100
   }'
```

è¾“å‡ºç»“æœç±»ä¼¼å¦‚ä¸‹ï¼š

```
  ...
  "overall_statistics": {
    "total_iterations": 1000,
    "successful_selections": 1000,
    "success_rate": 100.0,
    "mean_absolute_deviation": 0.7969,
    "max_absolute_deviation": 1.1954,
    "min_absolute_deviation": 0.121,
    "std_deviation": 0.5885
  },
  "quality_assessment": {
    "quality_grade": "Excellent",
    "quality_score": 99.2,
    "is_acceptable": true,
    "recommendations": [],
    "summary": "Mean deviation 0.7969%, max deviation 1.1954%, quality grade: Excellent"
  },
  ...
```



## 3. å¦‚æœä½ æ˜¯ä¸­æ–‡ç”¨æˆ·ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è„šæœ¬è¿›è¡Œæ›´ç›´è§‚çš„è¯„æµ‹

æ‰§è¡Œ`tests/test_probability_analysis.py`ç¨‹åºï¼Œå‡ºç°å¦‚ä¸‹æç¤ºï¼Œé€‰æ‹©1å¯ä»¥ä¸éœ€è¦llm-mock-apiçš„è¿è¡Œï¼Œå¦‚é€‰æ‹©2åˆ™éœ€è¦llm-mock-apiè¿è¡Œã€‚

```
ğŸ¯ åŠ æƒéšæœºç®—æ³•æ¦‚ç‡åˆ†ææµ‹è¯•å·¥å…·
==================================================
ä»¥ä¸‹APIæ¬¡æ•°æ˜¯æŒ‡è°ƒç”¨http://localhost:8080/pools/example_pool1/Common/analyzeæ¥å£
è¿­ä»£æ¬¡æ•°æ˜¯æŒ‡è¯¥APIå†…éƒ¨æ¨¡æ‹Ÿé€‰æ‹©æ‰€æ‰§è¡Œçš„æ¬¡æ•°
æŠ¥å‘Šä¸­çš„å…³äºè¿­ä»£æ¬¡æ•°çš„è€—æ—¶èƒ½ååº”ç¨‹åºå†…éƒ¨é€‰æ‹©ç®—æ³•çš„è€—æ—¶
APIçš„è€—æ—¶åŠé€Ÿç‡ä¸èƒ½ä»£è¡¨çœŸå®çš„/scheduler/select APIæ¥å£æ€§èƒ½
==================================================
è¯·é€‰æ‹©æµ‹è¯•æ–¹å¼:
1. æœ¬åœ°æµ‹è¯•ï¼ˆç›´æ¥è°ƒç”¨ç®—æ³•ï¼‰
2. APIæµ‹è¯•ï¼ˆé€šè¿‡HTTPæ¥å£ï¼‰,éœ€è¦ç¯å¢ƒæä¾›æ¨¡æ‹Ÿexample_pool1çš„3ä¸ªæˆå‘˜
3. ç®—æ³•å¯¹æ¯”æµ‹è¯•
4. å…¨éƒ¨æµ‹è¯•
5. è‡ªå®šä¹‰iterationsçš„APIæµ‹è¯•
6. å¤šæ¬¡APIè¯·æ±‚æ€§èƒ½æµ‹è¯•

è¯·è¾“å…¥é€‰æ‹© (1-6): 1
```

é€‰é¡¹1çš„æµ‹è¯•ï¼Œç»“æœç±»ä¼¼å¦‚ä¸‹ï¼š

```

ğŸ“Š æ¦‚ç‡åˆ†æç»“æœ:
================================================================================
Pool: example_pool1:Common
æˆå‘˜æ•°: 3, æ€»Score: 1.5

ğŸ“ˆ æ¦‚ç‡å¯¹æ¯”:
------------------------------------------------------------
æˆå‘˜                   ç†è®ºæ¦‚ç‡         å®é™…æ¦‚ç‡         ç»å¯¹åå·®
------------------------------------------------------------
127.0.0.1:8001       58.67      % 59.00      % 0.33       %
127.0.0.1:8002       33.33      % 32.30      % 1.03       %
127.0.0.1:8003       8.00       % 8.70       % 0.70       %

ğŸ“Š æ•´ä½“ç»Ÿè®¡:
  æ€»è¿­ä»£æ¬¡æ•°: 1000
  æˆåŠŸé€‰æ‹©æ¬¡æ•°: 1000
  æˆåŠŸç‡: 100.00%
  å¹³å‡ç»å¯¹åå·®: 0.69%
  æœ€å¤§ç»å¯¹åå·®: 1.03%
  æœ€å°ç»å¯¹åå·®: 0.33%
  åå·®æ ‡å‡†å·®: 0.35%

â­ è´¨é‡è¯„ä¼°:
  è´¨é‡ç­‰çº§: Excellent
  è´¨é‡è¯„åˆ†: 99.31
  æ˜¯å¦å¯æ¥å—: æ˜¯
  æ€»ç»“: Mean deviation 0.6889%, max deviation 1.0333%, quality grade: Excellent
```



### é™„å½•

#### è´¨é‡ç­‰çº§å®šä¹‰

| ç­‰çº§         | å¹³å‡åå·® | æœ€å¤§åå·® | æˆåŠŸç‡ | è¯„ä»·                               |
| ------------ | -------- | -------- | ------ | ---------------------------------- |
| **ä¼˜ç§€**     | < 1.0%   | < 2.0%   | > 99%  | ç®—æ³•è¡¨ç°ä¼˜å¼‚ï¼Œåå·®åœ¨æ­£å¸¸ç»Ÿè®¡èŒƒå›´å†… |
| **è‰¯å¥½**     | < 2.0%   | < 5.0%   | > 95%  | ç®—æ³•è¡¨ç°è‰¯å¥½ï¼Œåå·®å¯æ¥å—           |
| **ä¸€èˆ¬**     | < 5.0%   | < 10.0%  | > 90%  | ç®—æ³•åŸºæœ¬å¯ç”¨ï¼Œæœ‰ä¼˜åŒ–ç©ºé—´           |
| **éœ€è¦ä¼˜åŒ–** | â‰¥ 5.0%   | â‰¥ 10.0%  | â‰¤ 90%  | ç®—æ³•éœ€è¦ä¼˜åŒ–æˆ–å­˜åœ¨é—®é¢˜             |

#### å»ºè®®é˜ˆå€¼

- **1000æ¬¡æµ‹è¯•**ï¼šå¹³å‡åå·® < 2%ï¼Œæœ€å¤§åå·® < 5% ä¸ºè‰¯å¥½
- **10000æ¬¡æµ‹è¯•**ï¼šå¹³å‡åå·® < 1%ï¼Œæœ€å¤§åå·® < 3% ä¸ºä¼˜ç§€