# F5 LLMæ¨ç†ç½‘å…³è°ƒåº¦å™¨ - æ—¥å¿—ç®¡ç†æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»F5 LLMæ¨ç†ç½‘å…³è°ƒåº¦å™¨çš„æ—¥å¿—ç®¡ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬æ—¥å¿—æ–‡ä»¶ä½ç½®ã€è‡ªå®šä¹‰é…ç½®ã€ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿—ç®¡ç†ç­–ç•¥ä»¥åŠå®¹å™¨ç¯å¢ƒä¸‹çš„æœ€ä½³å®è·µã€‚

## ğŸ—‚ï¸ æ—¥å¿—æ–‡ä»¶åˆ†æ

### é»˜è®¤æ—¥å¿—ä½ç½®
- **é»˜è®¤æ–‡ä»¶å**: `scheduler.log`
- **é»˜è®¤ä½ç½®**: ç¨‹åºè¿è¡Œç›®å½•ä¸‹
- **è¾“å‡ºæ–¹å¼**: åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
- **æ—¥å¿—çº§åˆ«**: æ§åˆ¶å°å’Œæ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„é…ç½®çº§åˆ«ï¼ˆåœ¨`config/scheduler-config.yaml`ä¸­è®¾ç½®ï¼‰
- **çº§åˆ«é…ç½®**: é€šè¿‡`global.log_level`å­—æ®µæ§åˆ¶ï¼ˆDEBUGã€INFOã€WARNINGã€ERRORã€CRITICALï¼‰

### æ—¥å¿—é…ç½®æ”¯æŒ

#### é…ç½®æ–‡ä»¶è®¾ç½®
åœ¨ `config/scheduler-config.yaml` ä¸­é…ç½®æ—¥å¿—çº§åˆ«ï¼š
```yaml
global:
  # æ—¥å¿—çº§åˆ«é…ç½®ï¼ˆæ¨èä½¿ç”¨æ­¤é…ç½®ï¼‰
  # å¯é€‰å€¼: DEBUG, INFO, WARNING, ERROR, CRITICAL
  # DEBUG: æ˜¾ç¤ºæ‰€æœ‰çº§åˆ«æ—¥å¿—
  # INFO: æ˜¾ç¤º INFO, WARNING, ERROR, CRITICAL çº§åˆ«æ—¥å¿—  
  # WARNING: ä»…æ˜¾ç¤º WARNING, ERROR, CRITICAL çº§åˆ«æ—¥å¿—
  # ERROR: ä»…æ˜¾ç¤º ERROR, CRITICAL çº§åˆ«æ—¥å¿—
  # CRITICAL: ä»…æ˜¾ç¤º CRITICAL çº§åˆ«æ—¥å¿—
  log_level: INFO
  
  # å‘åå…¼å®¹çš„è°ƒè¯•å¼€å…³ï¼ˆå½“æœªé…ç½®log_levelæ—¶ä½¿ç”¨ï¼‰
  # log_debug: True
```

#### ç¨‹åºåˆå§‹åŒ–
```python
# ç¨‹åºå¯åŠ¨æ—¶çš„æ—¥å¿—é…ç½®
self.logger = init_logger(
    debug=self.config.global_config.log_debug,
    log_file=log_file_path,  # æ”¯æŒè‡ªå®šä¹‰è·¯å¾„
    log_level=self.config.global_config.log_level  # æ§åˆ¶å°å’Œæ–‡ä»¶ä½¿ç”¨ç›¸åŒçº§åˆ«
)
```

**é‡è¦è¯´æ˜**ï¼šé…ç½®çš„æ—¥å¿—çº§åˆ«ä¼šåŒæ—¶åº”ç”¨äºæ§åˆ¶å°è¾“å‡ºå’Œæ–‡ä»¶è¾“å‡ºï¼Œç¡®ä¿è¡Œä¸ºä¸€è‡´æ€§ã€‚

## ğŸ”§ è‡ªå®šä¹‰æ—¥å¿—ä½ç½®

### 1. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ¨èï¼‰
```bash
# è®¾ç½®è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶è·¯å¾„
export LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log"

# å¯ç”¨stdoutè¾“å‡ºï¼ˆå®¹å™¨ç¯å¢ƒæ¨èï¼‰
export LOG_TO_STDOUT=true
export LOG_FILE_PATH=""
```

### 2. ä»£ç çº§é…ç½®
ä¿®æ”¹ `main.py` ä¸­çš„æ—¥å¿—åˆå§‹åŒ–éƒ¨åˆ†ï¼š
```python
log_file_path = os.getenv('LOG_FILE_PATH', '/custom/path/scheduler.log')
```

## ğŸ­ ç”Ÿäº§ç¯å¢ƒæ—¥å¿—ç®¡ç†ç­–ç•¥

### ğŸ³ å®¹å™¨ç¯å¢ƒï¼ˆDocker/Kubernetesï¼‰

#### æ¨èæ–¹æ¡ˆï¼šæ ‡å‡†è¾“å‡ºæ¨¡å¼
**æœ€ç®€å•ã€æœ€æ¨èçš„æ–¹å¼**

**1. è®¾ç½®ç¯å¢ƒå˜é‡**
```bash
# å…³é”®é…ç½®ï¼šè®©æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
export LOG_TO_STDOUT=true
```

**2. Dockerè¿è¡Œ**
```bash
docker run -d \
  --name f5-scheduler \
  -p 8080:8080 \
  -v $(pwd)/config/scheduler-config.yaml:/app/config/scheduler-config.yaml:ro \
  -e F5_PASSWORD=your-password \
  -e METRIC_PWD=your-metric-password \ #å¯é€‰ï¼Œéå¿…é¡»
  -e LOG_TO_STDOUT=true \
  --log-driver json-file \
  --log-opt max-size=100m \
  --log-opt max-file=3 \
  --restart unless-stopped \
  f5-scheduler:latest
```

**3. æŸ¥çœ‹å’Œç®¡ç†æ—¥å¿—**
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f f5-scheduler

# å¯¼å‡ºæ—¥å¿—åˆ°æ–‡ä»¶
docker logs f5-scheduler > scheduler-$(date +%Y%m%d).log

# æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å¤§å°ï¼ˆDockerè‡ªåŠ¨ç®¡ç†ï¼‰
docker inspect f5-scheduler | grep -A 5 "LogConfig"
```

**4. Kubernetesé…ç½®**
```yaml
# åœ¨Deploymentä¸­è®¾ç½®
env:
- name: LOG_TO_STDOUT
  value: "true"
- name: F5_PASSWORD
  valueFrom:
    secretKeyRef:
      name: f5-secrets
      key: password
- name: METRIC_PWD
  valueFrom:
    secretKeyRef:
      name: f5-secrets
      key: metric-pwd
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ— éœ€ç®¡ç†æ—¥å¿—æ–‡ä»¶
- âœ… Docker/K8sè‡ªåŠ¨å¤„ç†æ—¥å¿—è½®è½¬
- âœ… æ˜“äºé›†æˆæ—¥å¿—æ”¶é›†ç³»ç»Ÿ
- âœ… ç¬¦åˆäº‘åŸç”Ÿæœ€ä½³å®è·µ

---

### ğŸ–¥ï¸ éå®¹å™¨ç¯å¢ƒï¼ˆä¼ ç»Ÿéƒ¨ç½²ï¼‰

#### æ¨èæ–¹æ¡ˆï¼šæ–‡ä»¶æ—¥å¿— + è‡ªåŠ¨è½®è½¬

**1. è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„**
```bash
è®¾ç½®ç¯å¢ƒå˜é‡
export LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log"
```

**2. åˆ›å»ºæ—¥å¿—ç›®å½•**
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/f5-scheduler

# è®¾ç½®æƒé™ï¼ˆå‡è®¾ç¨‹åºä»¥schedulerç”¨æˆ·è¿è¡Œï¼‰
sudo chown scheduler:scheduler /var/log/f5-scheduler
sudo chmod 755 /var/log/f5-scheduler
```

**3. é…ç½®è‡ªåŠ¨æ—¥å¿—è½®è½¬**
```bash
# ç”Ÿæˆé€‚é…å½“å‰è·¯å¾„çš„logrotateé…ç½®
LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log" ./scripts/log-management.sh logrotate

# å®‰è£…logrotateé…ç½®
sudo cp /tmp/f5-scheduler-logrotate.conf /etc/logrotate.d/f5-scheduler

# æµ‹è¯•é…ç½®
sudo logrotate -d /etc/logrotate.d/f5-scheduler
```

**4. è®¾ç½®å®šæ—¶ä»»åŠ¡**
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œæ—¥å¿—ç®¡ç†ï¼‰
0 2 * * * LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log" /opt/f5-scheduler/scripts/log-management.sh all
```

**5. æ—¥å¸¸ç®¡ç†å‘½ä»¤**
```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/f5-scheduler/scheduler.log

# æ£€æŸ¥æ—¥å¿—çŠ¶æ€
LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log" ./scripts/log-management.sh report

# æ‰‹åŠ¨è½®è½¬ï¼ˆå¦‚æœæ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼‰
LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log" ./scripts/log-management.sh rotate

# æ¸…ç†æ—§æ—¥å¿—
LOG_FILE_PATH="/var/log/f5-scheduler/scheduler.log" ./scripts/log-management.sh cleanup
```

---

### ğŸ“‹ å¿«é€Ÿé…ç½®æ£€æŸ¥æ¸…å•

#### å®¹å™¨ç¯å¢ƒæ£€æŸ¥
- [ ] è®¾ç½® `LOG_TO_STDOUT=true`
- [ ] é…ç½®Dockeræ—¥å¿—é©±åŠ¨ï¼ˆ`--log-opt max-size=100m --log-opt max-file=3`ï¼‰
- [ ] è®¾ç½®å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼ˆ`F5_PASSWORD`ï¼‰
- [ ] å¯é€‰ï¼šè®¾ç½®ç›‘æ§ç¯å¢ƒå˜é‡ï¼ˆ`METRIC_PWD`ï¼‰
- [ ] æŒ‚è½½é…ç½®æ–‡ä»¶

#### éå®¹å™¨ç¯å¢ƒæ£€æŸ¥  
- [ ] è®¾ç½® `LOG_FILE_PATH` ç¯å¢ƒå˜é‡
- [ ] åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶è®¾ç½®æƒé™
- [ ] ç”Ÿæˆå¹¶å®‰è£…logrotateé…ç½®
- [ ] è®¾ç½®å®šæ—¶ä»»åŠ¡
- [ ] æµ‹è¯•æ—¥å¿—è½®è½¬

---

### ğŸš¨ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

#### é—®é¢˜1: å®¹å™¨ä¸­çœ‹ä¸åˆ°æ—¥å¿—
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker inspect container-name | grep LOG_TO_STDOUT

# å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‡æ–°è¿è¡Œå®¹å™¨
docker rm -f container-name
docker run -e LOG_TO_STDOUT=true ...
```

#### é—®é¢˜2: éå®¹å™¨ç¯å¢ƒæ—¥å¿—æ–‡ä»¶è¿‡å¤§
```bash
# ç«‹å³è½®è½¬æ—¥å¿—
LOG_FILE_PATH="/path/to/scheduler.log" ./scripts/log-management.sh rotate

# æ£€æŸ¥logrotateé…ç½®
sudo logrotate -d /etc/logrotate.d/f5-scheduler
```

#### é—®é¢˜3: æƒé™é—®é¢˜
```bash
# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æƒé™
ls -la /var/log/f5-scheduler/

# ä¿®å¤æƒé™
sudo chown -R scheduler:scheduler /var/log/f5-scheduler/
```

---

### ğŸ¯ ç¯å¢ƒå˜é‡é…ç½®æ€»ç»“

| ç¯å¢ƒå˜é‡ | å®¹å™¨ç¯å¢ƒ | éå®¹å™¨ç¯å¢ƒ | è¯´æ˜ |
|----------|----------|------------|------|
| `LOG_TO_STDOUT` | `true` | `false` | æ§åˆ¶æ—¥å¿—è¾“å‡ºæ–¹å¼ |
| `LOG_FILE_PATH` | ä¸è®¾ç½® | `/var/log/f5-scheduler/scheduler.log` | æ—¥å¿—æ–‡ä»¶è·¯å¾„ |
| `F5_PASSWORD` | å¿…éœ€ | å¿…éœ€ | F5è®¾å¤‡å¯†ç  |
| `METRIC_PWD` | éå¿…é¡» | éå¿…é¡» | ç›‘æ§æŒ‡æ ‡å¯†ç  |

è¿™æ ·é…ç½®åï¼Œå®¹å™¨ç¯å¢ƒä¸‹Dockerä¼šè‡ªåŠ¨ç®¡ç†æ—¥å¿—è½®è½¬ï¼Œéå®¹å™¨ç¯å¢ƒä¸‹logrotateä¼šè‡ªåŠ¨å¤„ç†æ—¥å¿—æ–‡ä»¶ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚ 