# Dockeræ„å»ºä»£ç†é…ç½®æŒ‡å—

## æ¦‚è¿°

å½“æ‚¨åœ¨ä¼ä¸šç½‘ç»œç¯å¢ƒæˆ–éœ€è¦é€šè¿‡ä»£ç†è®¿é—®äº’è”ç½‘æ—¶ï¼ŒDockeræ„å»ºè¿‡ç¨‹å¯èƒ½æ— æ³•ç›´æ¥è®¿é—®å¤–éƒ¨èµ„æºï¼ˆå¦‚ä¸‹è½½åŸºç¡€é•œåƒã€å®‰è£…åŒ…ç­‰ï¼‰ã€‚æˆ‘ä»¬çš„è„šæœ¬ç°åœ¨æ”¯æŒåœ¨æ„å»ºæ—¶é…ç½®ä»£ç†ã€‚

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### ä½¿ç”¨æ‚¨çš„ä»£ç†åœ°å€
```bash
# ä½¿ç”¨HTTP/HTTPSä»£ç†æ„å»º
./build-and-run.sh build --proxy http://127.0.0.1:8010

# å¤šå¹³å°æ„å»ºä½¿ç”¨ä»£ç†
./build-and-run.sh buildx --proxy http://127.0.0.1:8010 --production
```

## ğŸ“‹ ä»£ç†å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `--proxy URL` | åŒæ—¶è®¾ç½®HTTPå’ŒHTTPSä»£ç† | `--proxy http://127.0.0.1:8010` |
| `--http-proxy URL` | ä»…è®¾ç½®HTTPä»£ç† | `--http-proxy http://proxy.company.com:8080` |
| `--https-proxy URL` | ä»…è®¾ç½®HTTPSä»£ç† | `--https-proxy http://proxy.company.com:8080` |
| `--no-proxy HOSTS` | ä¸ä½¿ç”¨ä»£ç†çš„ä¸»æœºåˆ—è¡¨ | `--no-proxy localhost,127.0.0.1,.local` |

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šä¼ä¸šç½‘ç»œç¯å¢ƒ
```bash
# ä¼ä¸šä»£ç†æœåŠ¡å™¨
./build-and-run.sh buildx --production \
  --proxy http://proxy.company.com:8080 \
  --no-proxy localhost,127.0.0.1,*.company.com \
  -t registry.company.com/f5-scheduler:v1.0
```

### åœºæ™¯2ï¼šå¼€å‘ç¯å¢ƒï¼ˆæ‚¨çš„æƒ…å†µï¼‰
```bash
# æœ¬åœ°ä»£ç†
./build-and-run.sh build --proxy http://127.0.0.1:8010

# å¤šå¹³å°æ„å»º
./build-and-run.sh buildx --production \
  --proxy http://127.0.0.1:8010 \
  --platforms linux/amd64,linux/arm64 \
  --push -t localhost:6000/f5-scheduler:v1.0
```

### åœºæ™¯3ï¼šä¸åŒåè®®ä½¿ç”¨ä¸åŒä»£ç†
```bash
# HTTPå’ŒHTTPSä½¿ç”¨ä¸åŒä»£ç†
./build-and-run.sh buildx \
  --http-proxy http://http-proxy.company.com:8080 \
  --https-proxy http://https-proxy.company.com:8443 \
  --no-proxy localhost,127.0.0.1
```

## ğŸ”§ æŠ€æœ¯åŸç†

è„šæœ¬ä¼šå°†ä»£ç†è®¾ç½®ä½œä¸ºæ„å»ºå‚æ•°ä¼ é€’ç»™Dockerï¼š

```bash
# å®é™…æ‰§è¡Œçš„å‘½ä»¤ç¤ºä¾‹
docker buildx build \
  --build-arg HTTP_PROXY=http://127.0.0.1:8010 \
  --build-arg http_proxy=http://127.0.0.1:8010 \
  --build-arg HTTPS_PROXY=http://127.0.0.1:8010 \
  --build-arg https_proxy=http://127.0.0.1:8010 \
  -t f5-scheduler:latest .
```

### ç¯å¢ƒå˜é‡è¯´æ˜
- `HTTP_PROXY` / `http_proxy`: HTTPåè®®ä»£ç†
- `HTTPS_PROXY` / `https_proxy`: HTTPSåè®®ä»£ç†  
- `NO_PROXY` / `no_proxy`: ä¸ä½¿ç”¨ä»£ç†çš„ä¸»æœºåˆ—è¡¨

## ğŸ“ Dockerfileå…¼å®¹æ€§

æˆ‘ä»¬çš„Dockerfileå·²ç»æ”¯æŒä»£ç†å‚æ•°ï¼Œæ— éœ€ä¿®æ”¹ï¼š

```dockerfile
# Dockerfileä¸­ä¼šè‡ªåŠ¨ä½¿ç”¨è¿™äº›ARG
ARG HTTP_PROXY
ARG HTTPS_PROXY
ARG NO_PROXY
ARG http_proxy
ARG https_proxy
ARG no_proxy

# åœ¨RUNå‘½ä»¤ä¸­ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ
RUN apt-get update && apt-get install -y ...
RUN pip install -r requirements.txt
```

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. ä»£ç†è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ä»£ç†æ˜¯å¦å¯è®¿é—®
curl -x http://127.0.0.1:8010 http://www.google.com

# å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ä»£ç†é…ç½®
```

### 2. éƒ¨åˆ†åŸŸåä¸éœ€è¦ä»£ç†
```bash
# ä½¿ç”¨no-proxyæ’é™¤æœ¬åœ°åŸŸå
./build-and-run.sh build \
  --proxy http://127.0.0.1:8010 \
  --no-proxy localhost,127.0.0.1,*.local,registry.company.com
```

### 3. ä»£ç†éœ€è¦è®¤è¯
```bash
# ä»£ç†URLä¸­åŒ…å«ç”¨æˆ·åå¯†ç 
./build-and-run.sh build --proxy http://username:password@proxy.company.com:8080
```

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å®é™…æ‰§è¡Œçš„å‘½ä»¤
è„šæœ¬ä¼šæ˜¾ç¤ºå®Œæ•´çš„æ„å»ºå‘½ä»¤ï¼ŒåŒ…å«ä»£ç†å‚æ•°ï¼š
```bash
æ‰§è¡Œå‘½ä»¤: docker buildx build --build-arg HTTP_PROXY=http://127.0.0.1:8010 ...
```

### åœ¨Dockerfileä¸­è°ƒè¯•ä»£ç†
```dockerfile
# ä¸´æ—¶æ·»åŠ åˆ°Dockerfileä¸­æŸ¥çœ‹ä»£ç†è®¾ç½®
RUN echo "HTTP_PROXY=$HTTP_PROXY"
RUN echo "HTTPS_PROXY=$HTTPS_PROXY"
RUN curl -I http://www.google.com || echo "ä»£ç†è¿æ¥å¤±è´¥"
```

## ğŸ“š å®Œæ•´ç¤ºä¾‹

### æ‚¨çš„ä½¿ç”¨åœºæ™¯
```bash
# 1. åŸºæœ¬æ„å»ºï¼ˆå¼€å‘ç‰ˆï¼‰
./build-and-run.sh build --proxy http://127.0.0.1:8010

# 2. ç”Ÿäº§ç‰ˆæ„å»º
./build-and-run.sh build --production --proxy http://127.0.0.1:8010

# 3. å¤šå¹³å°æ„å»º
./build-and-run.sh buildx --production \
  --proxy http://127.0.0.1:8010 \
  --platforms linux/amd64,linux/arm64

# 4. æ„å»ºå¹¶æ¨é€åˆ°æœ¬åœ°registry
./build-and-run.sh buildx --production \
  --proxy http://127.0.0.1:8010 \
  --push -t localhost:6000/f5-scheduler:v1.0

# 5. è¿è¡Œå®¹å™¨
./build-and-run.sh run --f5-password your_password -t v1.0
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æµ‹è¯•ä»£ç†è¿æ¥**: æ„å»ºå‰å…ˆç¡®è®¤ä»£ç†å¯ç”¨
2. **åˆç†è®¾ç½®no-proxy**: é¿å…æœ¬åœ°æœåŠ¡èµ°ä»£ç†
3. **ä½¿ç”¨ç¯å¢ƒå˜é‡**: å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡é¿å…æ¯æ¬¡è¾“å…¥
   ```bash
   export HTTP_PROXY=http://127.0.0.1:8010
   export HTTPS_PROXY=http://127.0.0.1:8010
   ./build-and-run.sh build  # ä¼šè‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡
   ```
4. **å®‰å…¨è€ƒè™‘**: é¿å…åœ¨å‘½ä»¤è¡Œä¸­æš´éœ²ä»£ç†è®¤è¯ä¿¡æ¯

ç°åœ¨æ‚¨å¯ä»¥æ„‰å¿«åœ°åœ¨ä»£ç†ç¯å¢ƒä¸‹æ„å»ºDockeré•œåƒäº†ï¼ğŸ‰ 