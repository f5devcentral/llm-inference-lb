# F5 LLM推理网关调度器日志轮转配置
# 
# 安装说明：
# 1. 复制到系统目录：sudo cp config/logrotate.conf /etc/logrotate.d/f5-scheduler
# 2. 根据实际部署的日志路径修改下面的路径配置
# 3. 测试配置：sudo logrotate -d /etc/logrotate.d/f5-scheduler
# 4. 手动执行：sudo logrotate -f /etc/logrotate.d/f5-scheduler
#
# 路径配置说明：
# - 默认路径：/opt/f5-scheduler/logs/scheduler.log
# - 如果使用了LOG_FILE_PATH环境变量，请相应修改下面的路径
# - 支持通配符匹配多个日志文件

# 主日志文件路径（请根据实际部署路径调整）
/opt/f5-scheduler/logs/scheduler.log
/var/log/f5-scheduler/scheduler.log
/var/log/scheduler.log
/app/logs/scheduler.log {
    # 每天轮转
    daily
    
    # 保留30天的日志文件
    rotate 30
    
    # 如果日志文件不存在，不报错
    missingok
    
    # 如果日志文件为空，不轮转
    notifempty
    
    # 轮转后压缩日志文件
    compress
    
    # 延迟压缩，保留最新的一个轮转文件不压缩
    delaycompress
    
    # 为轮转的日志文件添加日期后缀
    dateext
    
    # 日期格式：YYYYMMDD
    dateformat -%Y%m%d
    
    # 轮转后的文件权限（根据实际用户调整）
    create 644 scheduler scheduler
    
    # 大小限制：单个日志文件超过100MB时轮转
    size 100M
    
    # 复制并截断原文件，而不是移动
    # 这样Python程序可以继续写入，无需信号通知
    copytruncate
    
    # 共享脚本：多个文件使用相同的处理逻辑
    sharedscripts
    
    # 轮转后执行的脚本（可选）
    postrotate
        # 注意：使用copytruncate时，通常不需要信号处理
        # Python的logging模块会自动处理文件轮转
        
        # 如果需要记录轮转事件到系统日志
        logger -t f5-scheduler "Log rotation completed"
        
        # 可选：清理临时文件
        find /tmp -name "f5-scheduler-*" -mtime +1 -delete 2>/dev/null || true
    endscript
} 